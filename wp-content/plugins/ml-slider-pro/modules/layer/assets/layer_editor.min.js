!function(a){a(function(){var e={checkSaveRequest:function(){jQuery.active<1&&a(".spinner").hide(),setTimeout(e.checkSaveRequest,1e3)},checkForSelectedLayer:function(){0==a(".metaslider-active").length&&alert(metasliderpro.noLayerSelected)},createNewLayer:function(){a(".metaslider-active").removeClass("metaslider-active");var t=Math.floor(999999999*Math.random()+1),i=a("<div class='content' id='layer_content_"+t+"'>"+metasliderpro.newLayer+"</div>").css({color:"white",padding:"5px"}).attr("data-padding","5"),n=a("<div class='ms_content_wrap' />").css({height:"100%",background:"rgba(142, 142, 142, 0.50)"}).html(i),o=a("<div class='animation_out animated disabled'/>").attr("data-animation","disabled").attr("data-animation-delay","0").css({height:"100%",width:"100%"}).html(n),d=a("<div class='animation_in animated disabled' />").attr("data-animation","disabled").attr("data-animation-delay","0").css({width:"100%",height:"100%"}).html(o),r=a("<div class='layer metaslider-active' />").css({width:"120px",height:"40px",top:"5px",left:"5px",position:"absolute"}).attr("data-width","120").attr("data-height","40").html(d);a("#htmlOverlay").append(r),e.makeLayerEditable(r)},updateLayerAnimationDelay:function(){var e=1e3*parseFloat(a("#animation_in_delay").val()),t=1e3*parseFloat(a("#animation_out_delay").val()),i=t+e;a(".metaslider-active .animation_in").attr("data-animation-delay",a("#animation_in_delay").val(),10).attr("style","animation-delay: "+e+"ms; -moz-animation-delay: "+e+"ms; -webkit-animation-delay: "+e+"ms;"),a(".metaslider-active .animation_out").attr("data-animation-delay",a("#animation_out_delay").val(),10).attr("style","animation-delay: "+i+"ms; -moz-animation-delay: "+i+"ms; -webkit-animation-delay: "+i+"ms;")},save:function(t){a(".spinner").show(),a("#"+t).val(e.get_html()),a("#ms-save").click()},save_on_close:function(t){var i=a("#"+t).val(),n=e.get_html();i!=n&&confirm(metasliderpro.saveChanges)&&e.save(t)},render:function(t,n,o,d){var r=a("<input class='px-1' type='text' id='layerBgColor' />"),l=a("<div class='layer_editor' />"),s=(a("<div />"),a(a("#"+n).val())),c=a("<button class='button primary addLayer'>").html(metasliderpro.newLayer).bind("click",function(){e.createNewLayer()}),p=a("<span class='spinner'></span>"),m=a("<button class='button secondary save'>").html(metasliderpro.save).bind("click",function(){e.save(n)}),u=a("<div />").attr("class","ms-layer-container").css("position","relative").css("overflow","auto"),h=a("<div />").attr("id","htmlOverlay").css({position:"absolute",top:"0",left:"0",width:o+"px",height:d+"px"}).html(s),v=a("<img class='slide' />").attr("src",t).attr("width",o).attr("height",d).css("display","block"),g=a("<div class='toolbar_wrapper' />"),f=a("<div id='wysiwyg_buttons' />"),b=a("<div id='animation_toolbar'><b>"+metasliderpro.animation+":</b> </div>"),y=a("<div id='style_toolbar'></div>"),_=a("<input class='px-1' id='layer_padding' type='number' step='1' min='0' max='99' value='0' size='3' />"+metasliderpro.px+"&nbsp;").on("change",function(){a(".metaslider-active .content").attr("data-padding",a(this).val()),a(".metaslider-active .content").css("padding",a(this).val()+"px")}),w=a("<input class='px-1' type='checkbox' />").attr("checked","checked").change(function(){a(this).is(":checked")?a(".layer").each(function(){a(this).resizable({grid:5}).draggable({grid:[5,5]})}):a(".layer").each(function(){a(this).resizable({grid:!1}).draggable({grid:!1})})}),k=a("<label id='snapToGrid'>"+metasliderpro.snapToGrid+"</label>").css("float","right").append(w),I=[" ","flash","bounce","shake","tada","swing","wobble","wiggle","pulse","flip","flipInX","flipInY","fadeIn","fadeInUp","fadeInDown","fadeInLeft","fadeInRight","fadeInUpBig","fadeInDownBig","fadeInLeftBig","fadeInRightBig","bounceIn","bounceInDown","bounceInUp","bounceInLeft","bounceInRight","rotateIn","rotateInDownLeft","rotateInDownRight","rotateInUpLeft","rotateInUpRight","lightSpeedIn","hinge","rollIn"],O=[" ","flash","bounce","shake","tada","swing","wobble","wiggle","pulse","flip","rollOut","lightSpeedOut","rotateOut","rotateOutDownLeft","rotateOutDownRight","rotateOutUpLeft","rotateOutUpRight","bounceOut","bounceOutDown","bounceOutUp","bounceOutLeft","bounceOutRight","flipOutY","flipOutX","fadeOut","fadeOutUp","fadeOutDown","fadeOutLeft","fadeOutRight","fadeOutUpBig","fadeOutDownBig","fadeOutLeftBig","fadeOutRightBig","hinge"],L=a("<input class='px-1' id='animation_in_delay' type='number' max='99' min='0' step='0.1' size='3' value='0' />").change(function(){e.checkForSelectedLayer(),e.updateLayerAnimationDelay()}),x=a("<input class='px-1' id='animation_out_delay' type='number' max='99' min='0' step='0.1' size='3' value='0' />").change(function(){e.checkForSelectedLayer(),e.updateLayerAnimationDelay()}),C=a("<select id='animation_in' />").change(function(){e.checkForSelectedLayer();var t=a("#animation_in :selected").val(),i=a(".metaslider-active .animation_in");i.removeClass(i.data("animation")),i.addClass(t),i.attr("data-animation",t)}),D=a("<select id='animation_out' />").change(function(){e.checkForSelectedLayer();var t=a("#animation_out :selected").val(),i=a(".metaslider-active .animation_out");i.removeClass(i.data("animation")),i.addClass(t),i.attr("data-animation",t)});for(i=0;i<I.length;i++)a("<option/>").val(I[i]).html(I[i]).appendTo(C);for(i=0;i<O.length;i++)a("<option/>").val(O[i]).html(O[i]).appendTo(D);return h.after(v),b.append(metasliderpro.wait).append(L).append(metasliderpro.secondsAnd).append(C).append(metasliderpro.thenWait).append(x).append(metasliderpro.secondsAnd).append(D),y.append("<b>"+metasliderpro.padding+":</b>").append(_).append("&nbsp;&nbsp;<b>"+metasliderpro.background+":</b>").append(r).append(k),g.append(f).append(b).append(y),r.spectrum({preferredFormat:"rgb",showInput:!0,showAlpha:!0,change:function(e){a(".metaslider-active .content_wrap, .metaslider-active .ms_content_wrap").css("background-color",e.toRgbString())}}),u.append(h).append(v),l.append(c).append(m).append(p).append(g).append(u)},get_html:function(){var e=a("#htmlOverlay").clone();return a(".layer",e).each(function(){var e=a(this),t=a(".content",e),i=t.attr("id");t.html(CKEDITOR.instances[i].getData()),a(".drag_handle",e).remove(),a(".delete_button",e).remove(),t.removeAttr("tabindex"),t.removeAttr("spellcheck"),t.removeAttr("contenteditable"),t.removeAttr("title"),t.removeAttr("aria-describedby"),t.removeAttr("role"),t.removeAttr("aria-label"),t.removeClass("cke_editable_inline cke_contents_ltr cke_show_borders cke_editable cke_focus"),e.removeClass("ui-resizable"),e.removeClass("ui-draggable"),e.removeClass("metaslider-active"),e.css("cursor",""),e.css("background-position",""),e.css("background-repeat",""),a(".ui-resizable-handle",e).remove()}),e.html()},init:function(){CKEDITOR.disableAutoInline=!0,CKEDITOR.config.allowedContent=!0,CKEDITOR.config.language="en",e.checkSaveRequest(),a(".layer").each(function(){e.makeLayerEditable(a(this))})},makeLayerEditable:function(e){var t=a("<div class='delete_button'>X</div>").click(function(){confirm(metasliderpro.areYouSure)&&e.remove()});e.prepend(t).append("<div class='drag_handle'>X</div>").resizable({handles:"se",containment:"#htmlOverlay",grid:5,stop:function(e,t){var i=t.size.width;a(this).attr("data-width",i);var n=t.size.height;a(this).attr("data-height",n)}}).draggable({containment:"#htmlOverlay",handle:".drag_handle",grid:[5,5],stop:function(e,t){var i=t.position.top;a(this).attr("data-top",i);var n=t.position.left;a(this).attr("data-left",n)}}),a(".content",e).attr("contenteditable","true").focus(function(){a(".metaslider-active").removeClass("metaslider-active"),a(this).parent().parent().parent().parent().addClass("metaslider-active"),a("#animation_out_delay").val(a(".animation_out",e).data("animation-delay")),a("#animation_in_delay").val(a(".animation_in",e).data("animation-delay")),a("#animation_out").val(a(".animation_out",e).data("animation")),a("#animation_in").val(a(".animation_in",e).data("animation")),a("#layer_padding").val(a(".content",e).data("padding")),a("#layerBgColor").spectrum("set",a(".content_wrap, .ms_content_wrap",e).css("background-color"))}),CKEDITOR.inline(a(".content",e).attr("id"))}};a(".metaslider").on("metaslider/attachment/updated",".slide",function(e,t){t.img_url&&a(this).find(".openLayerEditor").data("thumb",t.img_url)}),a(".metaslider table#metaslider-slides-list").on("metaslider/size-has-changed",function(e,t){a(".openLayerEditor").data("width",t.width).data("height",t.height)}),a(".openLayerEditor").live("click",function(t){t.preventDefault(),a("#colorbox").removeAttr("tabindex");var i=a(this);if(!i.data("height"))return alert(metasliderpro.setHeight);if(!i.data("width"))return alert(metasliderpro.setWidth);var n=parseInt(i.data("width"),10)<850?850:parseInt(i.data("width"),10),o=i.closest(".slide").find(".update-image").data("cropped-img-url")||i.data("thumb");jQuery.colorbox({html:e.render(o,i.data("editor_id"),i.data("width"),i.data("height")),transition:"elastic",innerHeight:parseInt(i.data("height"),10)+152+"px",innerWidth:n+"px",scrolling:!0,className:"layerEditorCbox",onCleanup:function(){e.save_on_close(i.data("editor_id"))},onComplete:function(){e.init(),"rtl"==jQuery("html").attr("dir")&&"0px"==jQuery("#colorbox").css("left")&&jQuery("#colorbox").css("left","auto")}})})})}(jQuery);